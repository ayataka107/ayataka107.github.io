<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ランキング発表くん</title>
<style>
  body {
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif;
    background: #f4f4f4;
    margin: 0;
    padding: 20px;
  }
  h1 {
    text-align: center;
    margin-bottom: 20px;
  }
  .ranking-container {
    display: flex;
    gap: 20px;
    overflow-x: auto;
  }
  .ranking {
    background: #fff;
    padding: 10px;
    border-radius: 12px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    flex: 1;
    min-width: 220px;
  }
  .ranking-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
  }
  .ranking-header h2 {
    margin: 0;
    font-size: 1.2rem;
  }
  .delete-btn {
    background: #e74c3c;
    border: none;
    color: white;
    padding: 4px 8px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.8rem;
  }
  .delete-btn:hover { opacity: 0.8; }
  .slot {
    margin: 6px 0;
    padding: 8px;
    border-radius: 8px;
    text-align: center;
    background: #eee;
    cursor: pointer;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
    height: 1.5em; /* 1行分固定 */
    transition: all 0.2s ease;
  }
  .slot.revealed {
    white-space: normal;
    height: auto;
  }
  .edit-btn {
    margin-top: 4px;
    font-size: 0.75rem;
    padding: 2px 6px;
    border: 1px solid #555;
    border-radius: 6px;
    cursor: pointer;
    background: #fff;
    display: block;
  }
  .edit-input {
    width: 100%;
    padding: 6px;
    margin-top: 6px;
    border: 1px solid #aaa;
    border-radius: 6px;
    display: none;
  }
</style>
</head>
<body>
  <h1>ランキング発表くん</h1>
  <div class="ranking-container" id="rankingContainer"></div>

<script>
const colors = ["white", "#f8b407", "#5383c3", "#68be8d", "#b92636", "#e75f9d",
                "#c8c2c6", "#a1d6dc", "#fad664", "#9e8ce2", "#f36456", "#1ebecc"];

function setBoardColor(board, color) {
  board.style.backgroundColor = color;

  // 背景色の明度で文字色を自動調整
  const rgb = window.getComputedStyle(board).backgroundColor.match(/\d+/g);
  const brightness = (0.299*rgb[0] + 0.587*rgb[1] + 0.114*rgb[2]);
  if (brightness < 128) {
    board.style.color = "#fff"; // 暗い背景 → 白文字
  } else {
    board.style.color = "#000"; // 明るい背景 → 黒文字
  }
}

function createRanking(title, id) {
  const ranking = document.createElement("div");
  ranking.className = "ranking";
  ranking.dataset.id = id;

  const header = document.createElement("div");
  header.className = "ranking-header";
  const h2 = document.createElement("h2");
  h2.textContent = title;
  const delBtn = document.createElement("button");
  delBtn.textContent = "削除";
  delBtn.className = "delete-btn";
  delBtn.onclick = () => {
    ranking.remove();
    saveData();
  };
  header.appendChild(h2);
  header.appendChild(delBtn);
  ranking.appendChild(header);

  for (let i=1;i<=10;i++) {
    const slot = document.createElement("div");
    slot.className = "slot";
    slot.textContent = i + "位"; // 隠れているときは順位だけ

    const editInput = document.createElement("input");
    editInput.className = "edit-input";
    editInput.type = "text";

    const editBtn = document.createElement("button");
    editBtn.textContent = "編集";
    editBtn.className = "edit-btn";
    editBtn.onclick = (e) => {
      e.stopPropagation();
      editInput.style.display = "block";
      editInput.value = slot.dataset.content || "";
      editInput.focus();
    };

    editInput.addEventListener("keydown", (e)=>{
      if(e.key === "Enter") {
        slot.dataset.content = editInput.value;
        if (slot.classList.contains("revealed")) {
          slot.textContent = editInput.value;
        }
        slot.appendChild(editBtn);
        slot.appendChild(editInput);
        editInput.style.display = "none";
        saveData();
      }
    });

    slot.addEventListener("click", ()=>{
      if(slot.classList.contains("revealed")){
        slot.classList.remove("revealed");
        slot.textContent = i + "位";
        slot.appendChild(editBtn);
        slot.appendChild(editInput);
      } else {
        slot.classList.add("revealed");
        slot.textContent = slot.dataset.content || "";
        // 長いときはフォントサイズを調整
        slot.style.fontSize = (slot.textContent.length > 15) ? "0.85rem" : "1rem";
        slot.appendChild(editBtn);
        slot.appendChild(editInput);
      }
      saveData();
    });

    slot.appendChild(editBtn);
    slot.appendChild(editInput);
    ranking.appendChild(slot);
  }

  // 背景色切替（右クリック）
  ranking.addEventListener("contextmenu", (e)=>{
    e.preventDefault();
    const color = colors[Math.floor(Math.random()*colors.length)];
    setBoardColor(ranking, color);
    saveData();
  });

  document.getElementById("rankingContainer").appendChild(ranking);
  setBoardColor(ranking, "white");
  return ranking;
}

// 保存と復元
function saveData() {
  const data = [];
  document.querySelectorAll(".ranking").forEach(ranking=>{
    const id = ranking.dataset.id;
    const title = ranking.querySelector("h2").textContent;
    const slots = [];
    ranking.querySelectorAll(".slot").forEach(slot=>{
      slots.push({
        content: slot.dataset.content || "",
        revealed: slot.classList.contains("revealed")
      });
    });
    const color = window.getComputedStyle(ranking).backgroundColor;
    data.push({id,title,slots,color});
  });
  localStorage.setItem("rankingData", JSON.stringify(data));
}

function loadData() {
  const saved = localStorage.getItem("rankingData");
  if(!saved) return;
  const data = JSON.parse(saved);
  data.forEach(r=>{
    const ranking = createRanking(r.title, r.id);
    r.slots.forEach((s,i)=>{
      const slot = ranking.querySelectorAll(".slot")[i];
      slot.dataset.content = s.content;
      if(s.revealed){
        slot.classList.add("revealed");
        slot.textContent = s.content;
        slot.style.fontSize = (s.content.length > 15) ? "0.85rem" : "1rem";
      }
      slot.appendChild(slot.querySelector(".edit-btn"));
      slot.appendChild(slot.querySelector(".edit-input"));
    });
    setBoardColor(ranking, r.color);
  });
}

// 初期データがなければ1つ用意
window.onload = ()=>{
  if(!localStorage.getItem("rankingData")){
    createRanking("ランキング1","r1");
    saveData();
  } else {
    loadData();
  }
};
</script>
</body>
</html>
